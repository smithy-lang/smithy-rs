<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>RFC-0026: Client Crate Organization - Smithy Rust</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../overview.html"><strong aria-hidden="true">1.</strong> Design Overview</a></li><li class="chapter-item expanded "><a href="../tenets.html"><strong aria-hidden="true">2.</strong> Tenets</a></li><li class="chapter-item expanded "><a href="../faq.html"><strong aria-hidden="true">3.</strong> Design FAQ</a></li><li class="chapter-item expanded "><a href="../transport/overview.html"><strong aria-hidden="true">4.</strong> Transport</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../transport/operation.html"><strong aria-hidden="true">4.1.</strong> HTTP Operations</a></li><li class="chapter-item expanded "><a href="../transport/middleware.html"><strong aria-hidden="true">4.2.</strong> HTTP Middleware</a></li><li class="chapter-item expanded "><a href="../transport/connector.html"><strong aria-hidden="true">4.3.</strong> TLS Connector</a></li></ol></li><li class="chapter-item expanded "><a href="../smithy/overview.html"><strong aria-hidden="true">5.</strong> Smithy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../smithy/simple_shapes.html"><strong aria-hidden="true">5.1.</strong> Simple Shapes</a></li><li class="chapter-item expanded "><a href="../smithy/recursive_shapes.html"><strong aria-hidden="true">5.2.</strong> Recursive Shapes</a></li><li class="chapter-item expanded "><a href="../smithy/aggregate_shapes.html"><strong aria-hidden="true">5.3.</strong> Aggregate Shapes</a></li><li class="chapter-item expanded "><a href="../smithy/endpoint.html"><strong aria-hidden="true">5.4.</strong> Endpoint Resolution</a></li><li class="chapter-item expanded "><a href="../smithy/backwards-compat.html"><strong aria-hidden="true">5.5.</strong> Backwards Compatibility</a></li></ol></li><li class="chapter-item expanded "><a href="../client/overview.html"><strong aria-hidden="true">6.</strong> Client</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../client/orchestrator.html"><strong aria-hidden="true">6.1.</strong> What is the 'orchestrator' and why does it exist?</a></li><li class="chapter-item expanded "><a href="../client/identity_and_auth.html"><strong aria-hidden="true">6.2.</strong> Identity and Auth</a></li></ol></li><li class="chapter-item expanded "><a href="../server/overview.html"><strong aria-hidden="true">7.</strong> Server</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../server/middleware.html"><strong aria-hidden="true">7.1.</strong> Middleware</a></li><li class="chapter-item expanded "><a href="../server/instrumentation.html"><strong aria-hidden="true">7.2.</strong> Instrumentation</a></li><li class="chapter-item expanded "><a href="../server/from_parts.html"><strong aria-hidden="true">7.3.</strong> Accessing Un-modelled Data</a></li><li class="chapter-item expanded "><a href="../server/anatomy.html"><strong aria-hidden="true">7.4.</strong> The Anatomy of a Service</a></li><li class="chapter-item expanded "><a href="../server/code_generation.html"><strong aria-hidden="true">7.5.</strong> Generating Common Service Code</a></li></ol></li><li class="chapter-item expanded "><a href="../rfcs/overview.html"><strong aria-hidden="true">8.</strong> RFCs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rfcs/rfc0001_shared_config.html"><strong aria-hidden="true">8.1.</strong> RFC-0001: Sharing configuration between multiple clients</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0002_http_versions.html"><strong aria-hidden="true">8.2.</strong> RFC-0002: Supporting multiple HTTP versions for SDKs that use Event Stream</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0003_presigning_api.html"><strong aria-hidden="true">8.3.</strong> RFC-0003: API for Pre-signed URLs</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0004_retry_behavior.html"><strong aria-hidden="true">8.4.</strong> RFC-0004: Retry Behavior</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0005_service_generation.html"><strong aria-hidden="true">8.5.</strong> RFC-0005: Smithy Rust service framework</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0006_service_specific_middleware.html"><strong aria-hidden="true">8.6.</strong> RFC-0006: Service-specific middleware</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0007_split_release_process.html"><strong aria-hidden="true">8.7.</strong> RFC-0007: Split release process</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0008_paginators.html"><strong aria-hidden="true">8.8.</strong> RFC-0008: Paginators</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0009_example_consolidation.html"><strong aria-hidden="true">8.9.</strong> RFC-0009: Example Consolidation</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0010_waiters.html"><strong aria-hidden="true">8.10.</strong> RFC-0010: Waiters</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0011_crates_io_alpha_publishing.html"><strong aria-hidden="true">8.11.</strong> RFC-0011: Publishing Alpha to Crates.io</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0012_independent_crate_versioning.html"><strong aria-hidden="true">8.12.</strong> RFC-0012: Independent Crate Versioning</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0013_body_callback_apis.html"><strong aria-hidden="true">8.13.</strong> RFC-0013: Body Callback APIs</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0014_timeout_config.html"><strong aria-hidden="true">8.14.</strong> RFC-0014: Fine-grained timeout configuration</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0015_using_features_responsibly.html"><strong aria-hidden="true">8.15.</strong> RFC-0015: How Cargo "features" should be used in the SDK and runtime crates</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0016_flexible_checksum_support.html"><strong aria-hidden="true">8.16.</strong> RFC-0016: Supporting Flexible Checksums</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0017_customizable_client_operations.html"><strong aria-hidden="true">8.17.</strong> RFC-0017: Customizable Client Operations</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0018_logging_sensitive.html"><strong aria-hidden="true">8.18.</strong> RFC-0018: Logging in the Presence of Sensitive Data</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0019_event_streams_errors.html"><strong aria-hidden="true">8.19.</strong> RFC-0019: Event Streams Errors</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0020_service_builder.html"><strong aria-hidden="true">8.20.</strong> RFC-0020: Service Builder Improvements</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0021_dependency_versions.html"><strong aria-hidden="true">8.21.</strong> RFC-0021: Dependency Versions</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0022_error_context_and_compatibility.html"><strong aria-hidden="true">8.22.</strong> RFC-0022: Error Context and Compatibility</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0023_refine_builder.html"><strong aria-hidden="true">8.23.</strong> RFC-0023: Evolving the new service builder API</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0024_request_id.html"><strong aria-hidden="true">8.24.</strong> RFC-0024: RequestID</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0025_constraint_traits.html"><strong aria-hidden="true">8.25.</strong> RFC-0025: Constraint traits</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0026_client_crate_organization.html" class="active"><strong aria-hidden="true">8.26.</strong> RFC-0026: Client Crate Organization</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0027_endpoints_20.html"><strong aria-hidden="true">8.27.</strong> RFC-0027: Endpoints 2.0</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0028_sdk_credential_cache_type_safety.html"><strong aria-hidden="true">8.28.</strong> RFC-0028: SDK Credential Cache Type Safety</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0029_new_home_for_cred_types.html"><strong aria-hidden="true">8.29.</strong> RFC-0029: Finding New Home for Credential Types</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0030_serialization_and_deserialization.html"><strong aria-hidden="true">8.30.</strong> RFC-0030: Serialization And Deserialization</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0031_providing_fallback_credentials_on_timeout.html"><strong aria-hidden="true">8.31.</strong> RFC-0031: Providing Fallback Credentials on Timeout</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0032_better_constraint_violations.html"><strong aria-hidden="true">8.32.</strong> RFC-0032: Better Constraint Violations</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0033_improve_sdk_request_id_access.html"><strong aria-hidden="true">8.33.</strong> RFC-0033: Improving access to request IDs in SDK clients</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0034_smithy_orchestrator.html"><strong aria-hidden="true">8.34.</strong> RFC-0034: Smithy Orchestrator</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0035_collection_defaults.html"><strong aria-hidden="true">8.35.</strong> RFC-0035: Collection Defaults</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0036_http_dep_elimination.html"><strong aria-hidden="true">8.36.</strong> RFC-0036: HTTP Dependency Exposure</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0037_http_wrapper.html"><strong aria-hidden="true">8.37.</strong> RFC-0037: The HTTP Wrapper</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0038_retry_classifier_customization.html"><strong aria-hidden="true">8.38.</strong> RFC-0038: User-configurable retry classification</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0039_forward_compatible_errors.html"><strong aria-hidden="true">8.39.</strong> RFC-0039: Forward Compatible Errors</a></li><li class="chapter-item expanded "><a href="../rfcs/rfc0040_behavior_major_versions.html"><strong aria-hidden="true">8.40.</strong> RFC-0040: Behavior Major Versions</a></li></ol></li><li class="chapter-item expanded "><a href="../contributing/overview.html"><strong aria-hidden="true">9.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../contributing/writing_and_debugging_a_low-level_feature_that_relies_on_HTTP.html"><strong aria-hidden="true">9.1.</strong> Writing and debugging a low-level feature that relies on HTTP</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Smithy Rust</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rfc-client-crate-organization"><a class="header" href="#rfc-client-crate-organization">RFC: Client Crate Organization</a></h1>
<blockquote>
<p>Status: Implemented</p>
<p>Applies to: clients (and may impact servers due to shared codegen)</p>
</blockquote>
<p>This RFC proposes changing the organization structure of the generated client crates to:</p>
<ol>
<li>Make discovery in the crate documentation easier.</li>
<li>Facilitate re-exporting types from runtime crates in related modules without name collisions.</li>
<li>Facilitate feature gating operations for faster compile times in the future.</li>
</ol>
<h2 id="previous-organization"><a class="header" href="#previous-organization">Previous Organization</a></h2>
<p>Previously, crates were organized as such:</p>
<pre><code class="language-text">.
├── client
|   ├── fluent_builders
|   |   └── &lt;One fluent builder per operation&gt;
|   ├── Builder (*)
|   └── Client
├── config
|   ├── retry
|   |   ├── RetryConfig (*)
|   |   ├── RetryConfigBuilder (*)
|   |   └── RetryMode (*)
|   ├── timeout
|   |   ├── TimeoutConfig (*)
|   |   └── TimeoutConfigBuilder (*)
|   ├── AsyncSleep (*)
|   ├── Builder
|   ├── Config
|   └── Sleep (*)
├── error
|   ├── &lt;One module per error to contain a single struct named `Builder`&gt;
|   ├── &lt;One struct per error named `${error}`&gt;
|   ├── &lt;One struct per operation named `${operation}Error`&gt;
|   └── &lt;One enum per operation named `${operation}ErrorKind`&gt;
├── http_body_checksum (empty)
├── input
|   ├── &lt;One module per input to contain a single struct named `Builder`&gt;
|   └── &lt;One struct per input named `${operation}Input`&gt;
├── lens (empty)
├── middleware
|   └── DefaultMiddleware
├── model
|   ├── &lt;One module per shape to contain a single struct named `Builder`&gt;
|   └── &lt;One struct per shape&gt;
├── operation
|   ├── customize
|   |   ├── ClassifyRetry (*)
|   |   ├── CustomizableOperation
|   |   ├── Operation (*)
|   |   ├── RetryKind (*)
|   └── &lt;One struct per operation&gt;
├── output
|   ├── &lt;One module per output to contain a single struct named `Builder`&gt;
|   └── &lt;One struct per output named `${operation}Input`&gt;
├── paginator
|   ├── &lt;One struct per paginated operation named `${operation}Paginator`&gt;
|   └── &lt;Zero to one struct(s) per paginated operation named `${operation}PaginatorItems`&gt;
├── presigning
|   ├── config
|   |   ├── Builder
|   |   ├── Error
|   |   └── PresigningConfig
|   └── request
|       └── PresignedRequest
├── types
|   ├── AggregatedBytes (*)
|   ├── Blob (*)
|   ├── ByteStream (*)
|   ├── DateTime (*)
|   └── SdkError (*)
├── AppName (*)
├── Client
├── Config
├── Credentials (*)
├── Endpoint (*)
├── Error
├── ErrorExt (for some services)
├── PKG_VERSION
└── Region (*)
</code></pre>
<p><code>(*)</code> - signifies that a type is re-exported from one of the runtime crates</p>
<h2 id="proposed-changes"><a class="header" href="#proposed-changes">Proposed Changes</a></h2>
<p>This RFC proposes reorganizing types by operation first and foremost, and then rearranging
other pieces to reduce codegen collision risk.</p>
<h3 id="establish-a-pattern-for-builder-organization"><a class="header" href="#establish-a-pattern-for-builder-organization">Establish a pattern for builder organization</a></h3>
<p>Builders (distinct from fluent builders) are generated alongside all inputs, outputs, models, and errors.
They all follow the same overall pattern (where <code>shapeType</code> is <code>Input</code>, <code>Output</code>, or empty for models/errors):</p>
<pre><code class="language-text">.
└── module
    ├── &lt;One module per shape to contain a single struct named `Builder`&gt;
    └── &lt;One struct per shape named `${prefix}${shapeType}`&gt;
</code></pre>
<p>This results in large lists of modules that all have exactly one item in them, which makes browsing
the documentation difficult, and introduces the possibility of name collisions when re-exporting modules
from the runtime crates.</p>
<p>Builders should adopt a prefix and go into a single <code>builders</code> module, similar to how the fluent builders
currently work:</p>
<pre><code class="language-text">.
├── module
|   └── builders
|       └── &lt;One struct per shape named `${prefix}${shapeType}Builder`&gt;
└──---- &lt;One struct per shape named `${prefix}${shapeType}`&gt;
</code></pre>
<h3 id="organize-code-generated-types-by-operation"><a class="header" href="#organize-code-generated-types-by-operation">Organize code generated types by operation</a></h3>
<p>All code generated for an operation that isn't shared between operations will go into
operation-specific modules. This includes inputs, outputs, errors, parsers, and paginators.
Types shared across operations will remain in another module (discussed below), and
serialization/deserialization logic for those common types will also reside in that
common location for now. If operation feature gating occurs in the future, further
optimization can be done to track which of these are used by feature, or they can
be reorganized (this would be discussed in a future RFC and is out of scope here).</p>
<p>With code generated operations living in <code>crate::operation</code>, there is a high chance of name
collision with the <code>customize</code> module. To resolve this, <code>customize</code> will be moved into
<code>crate::client</code>.</p>
<p>The new <code>crate::operation</code> module will look as follows:</p>
<pre><code class="language-text">.
└── operation
    └── &lt;One module per operation named after the operation in lower_snake_case&gt;
        ├── paginator
        |   ├── `${operation}Paginator`
        |   └── `${operation}PaginatorItems`
        ├── builders
        |   ├── `${operation}FluentBuilder`
        |   ├── `${operation}InputBuilder`
        |   └── `${operation}OutputBuilder`
        ├── `${operation}Error`
        ├── `${operation}Input`
        ├── `${operation}Output`
        └── `${operation}Parser` (private/doc hidden)
</code></pre>
<h3 id="reorganize-the-crate-root"><a class="header" href="#reorganize-the-crate-root">Reorganize the crate root</a></h3>
<p>The crate root should only host the most frequently used types, or phrased differently,
the types that are critical to making a service call with default configuration,
or that are required for the most frequent config changes (such as setting credentials,
or changing the region/endpoint).</p>
<p>Previously, the following were exported in root:</p>
<pre><code class="language-text">.
├── AppName
├── Client
├── Config
├── Credentials
├── Endpoint
├── Error
├── ErrorExt (for some services)
├── PKG_VERSION
└── Region
</code></pre>
<p>The <code>AppName</code> is infrequently set, and will be moved into <code>crate::config</code>. Customers are encouraged
to use <code>aws-config</code> crate to resolve credentials, region, and endpoint. Thus, these types no longer
need to be at the top-level, and will be moved into <code>crate::config</code>. <code>ErrorExt</code> will be moved into
<code>crate::error</code>, but <code>Error</code> will stay in the crate root so that customers that alias the SDK crate
can easily reference it in their <code>Result</code>s:</p>
<pre><code class="language-rust ignore">use aws_sdk_s3 as s3;

fn some_function(/* ... */) -&gt; Result&lt;(), s3::Error&gt; {
    /* ... */
}</code></pre>
<p>The <code>PKG_VERSION</code> should move into a new <code>meta</code> module, which can also include other values in the future
such as the SHA-256 hash of the model used to produce the crate, or the version of smithy-rs that generated it.</p>
<h3 id="conditionally-remove-builder-from-crateclient"><a class="header" href="#conditionally-remove-builder-from-crateclient">Conditionally remove <code>Builder</code> from <code>crate::client</code></a></h3>
<p>Previously, the Smithy <code>Client</code> builder was re-exported alongside the SDK fluent <code>Client</code>
so that non-SDK clients could easily customize the underlying Smithy client by using
the fluent client's <code>Client::with_config</code> function or <code>From&lt;aws_smithy_client::client::Client&lt;C, M, R&gt;&gt;</code>
trait implementation.</p>
<p>This makes sense for non-SDK clients where customization of the connector and middleware types is supported
generically, but less sense for SDKs since the SDK clients are hardcoded to use <code>DynConnector</code> and <code>DynMiddleware</code>.</p>
<p>Thus, the Smithy client <code>Builder</code> should not be re-exported for SDKs.</p>
<h3 id="create-a-primitives-module"><a class="header" href="#create-a-primitives-module">Create a <code>primitives</code> module</a></h3>
<p>Previously, <code>crate::types</code> held re-exported types from <code>aws-smithy-types</code> that are used
by code generated structs/enums.</p>
<p>This module will be renamed to <code>crate::primitives</code> so that the name <code>types</code> can be
repurposed in the next section.</p>
<h3 id="repurpose-the-types-module"><a class="header" href="#repurpose-the-types-module">Repurpose the <code>types</code> module</a></h3>
<p>The name <code>model</code> is meaningless outside the context of code generation (although there is precedent
since both the Java V2 and Kotlin SDKs use the term). Previously, this module held all the generated
structs/enums that are referenced by inputs, outputs, and errors.</p>
<p>This RFC proposes that this module be renamed to <code>types</code>, and that all code generated types
for shapes that are reused between operations (basically anything that is not an input, output,
or error) be moved here. This would look as follows:</p>
<pre><code class="language-text">.
└── types
    ├── error
    |   ├── builders
    |   |   └── &lt;One struct per error named `${error}Builder`&gt;
    |   └── &lt;One struct per error named `${error}`&gt;
    ├── builders
    |   └── &lt;One struct per shape named `${shape}Builder`&gt;
    └── &lt;One struct per shape&gt;
</code></pre>
<p>Customers using the fluent builder should be able to just <code>use ${crate}::types::*;</code> to immediately
get access to all the shared types needed by the operations they are calling.</p>
<p>Additionally, moving the top-level code generated error types into <code>crate::types</code> will eliminate a name
collision issue in the <code>crate::error</code> module.</p>
<h3 id="repurpose-the-original-crateerror-module"><a class="header" href="#repurpose-the-original-crateerror-module">Repurpose the original <code>crate::error</code> module</a></h3>
<p>The <code>error</code> module is significantly smaller after all the code generated error types
are moved out of it. This top-level module is now available for re-exports and utilities.</p>
<p>The following will be re-exported in <code>crate::error</code>:</p>
<ul>
<li><code>aws_smithy_http::result::SdkError</code></li>
<li><code>aws_smithy_types::error::display::DisplayErrorContext</code></li>
</ul>
<p>For crates that have an <code>ErrorExt</code>, it will also be moved into <code>crate::error</code>.</p>
<h3 id="flatten-the-presigning-module"><a class="header" href="#flatten-the-presigning-module">Flatten the <code>presigning</code> module</a></h3>
<p>The <code>crate::presigning</code> module only has four members, so it should be flattened from:</p>
<pre><code class="language-text">.
└── presigning
    ├── config
    |   ├── Builder
    |   ├── Error
    |   └── PresigningConfig
    └── request
        └── PresignedRequest
</code></pre>
<p>to:</p>
<pre><code class="language-text">.
└── presigning
    ├── PresigningConfigBuilder
    ├── PresigningConfigError
    ├── PresigningConfig
    └── PresignedRequest
</code></pre>
<p>At the same time, <code>Builder</code> and <code>Error</code> will be renamed to <code>PresigningConfigBuilder</code> and <code>PresigningConfigError</code>
respectively since these will rarely be referred to directly (preferring <code>PresigningConfig::builder()</code> instead; the
error will almost always be unwrapped).</p>
<h3 id="remove-the-empty-modules"><a class="header" href="#remove-the-empty-modules">Remove the empty modules</a></h3>
<p>The <code>lens</code> and <code>http_body_checksum</code> modules have nothing inside them,
and their documentation descriptions are not useful to customers:</p>
<blockquote>
<p><code>lens</code>: Generated accessors for nested fields</p>
</blockquote>
<blockquote>
<p><code>http_body_checksum</code>: Functions for modifying requests and responses for the purposes of checksum validation</p>
</blockquote>
<p>These modules hold private functions that are used by other generated code, and should just be made
private or <code>#[doc(hidden)]</code> if necessary.</p>
<h2 id="new-organization"><a class="header" href="#new-organization">New Organization</a></h2>
<p>All combined, the following is the new publicly visible organization:</p>
<pre><code class="language-text">.
├── client
|   ├── customize
|   |   ├── ClassifyRetry (*)
|   |   ├── CustomizableOperation
|   |   ├── Operation (*)
|   |   └── RetryKind (*)
|   ├── Builder (only in non-SDK crates) (*)
|   └── Client
├── config
|   ├── retry
|   |   ├── RetryConfig (*)
|   |   ├── RetryConfigBuilder (*)
|   |   └── RetryMode (*)
|   ├── timeout
|   |   ├── TimeoutConfig (*)
|   |   └── TimeoutConfigBuilder (*)
|   ├── AppName (*)
|   ├── AsyncSleep (*)
|   ├── Builder
|   ├── Config
|   ├── Credentials (*)
|   ├── Endpoint (*)
|   ├── Region (*)
|   └── Sleep (*)
├── error
|   ├── DisplayErrorContext (*)
|   ├── ErrorExt (for some services)
|   └── SdkError (*)
├── meta
|   └── PKG_VERSION
├── middleware
|   └── DefaultMiddleware
├── operation
|   └── &lt;One module per operation named after the operation in lower_snake_case&gt;
|       ├── paginator
|       |   ├── `${operation}Paginator`
|       |   └── `${operation}PaginatorItems`
|       ├── builders
|       |   ├── `${operation}FluentBuilder`
|       |   ├── `${operation}InputBuilder`
|       |   └── `${operation}OutputBuilder`
|       ├── `${operation}Error`
|       ├── `${operation}Input`
|       ├── `${operation}Output`
|       └── `${operation}Parser` (private/doc hidden)
├── presigning
|   ├── PresigningConfigBuilder
|   ├── PresigningConfigError
|   ├── PresigningConfig
|   └── PresignedRequest
├── primitives
|   ├── AggregatedBytes (*)
|   ├── Blob (*)
|   ├── ByteStream (*)
|   └── DateTime (*)
├── types
|   ├── error
|   |   ├── builders
|   |   |   └── &lt;One struct per error named `${error}Builder`&gt;
|   |   └── &lt;One struct per error named `${error}`&gt;
|   ├── builders
|   |   └── &lt;One struct per shape named `${shape}Builder`&gt;
|   └── &lt;One struct per shape&gt;
├── Client
├── Config
└── Error
</code></pre>
<p><code>(*)</code> - signifies that a type is re-exported from one of the runtime crates</p>
<h2 id="changes-checklist"><a class="header" href="#changes-checklist">Changes Checklist</a></h2>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
Move <code>crate::AppName</code> into <code>crate::config</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Move <code>crate::PKG_VERSION</code> into a new <code>crate::meta</code> module</li>
<li><input disabled="" type="checkbox" checked=""/>
Move <code>crate::Endpoint</code> into <code>crate::config</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Move <code>crate::Credentials</code> into <code>crate::config</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Move <code>crate::Region</code> into <code>crate::config</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Move <code>crate::operation::customize</code> into <code>crate::client</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Finish refactor to decouple client/server modules</li>
<li><input disabled="" type="checkbox" checked=""/>
Organize code generated types by operation</li>
<li><input disabled="" type="checkbox" checked=""/>
Reorganize builders</li>
<li><input disabled="" type="checkbox" checked=""/>
Rename <code>crate::types</code> to <code>crate::primitives</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Rename <code>crate::model</code> to <code>crate::types</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Move <code>crate::error</code> into <code>crate::types</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Only re-export <code>aws_smithy_client::client::Builder</code> for non-SDK clients (remove from SDK clients)</li>
<li><input disabled="" type="checkbox" checked=""/>
Move <code>crate::ErrorExt</code> into <code>crate::error</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Re-export <code>aws_smithy_types::error::display::DisplayErrorContext</code> and <code>aws_smithy_http::result::SdkError</code> in <code>crate::error</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Move <code>crate::paginator</code> into <code>crate::operation</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Flatten <code>crate::presigning</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Hide or remove <code>crate::lens</code> and <code>crate::http_body_checksum</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Move fluent builders into <code>crate::operation::x::builders</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Remove/hide operation <code>ParseResponse</code> implementations in <code>crate::operation</code></li>
<li><input disabled="" type="checkbox" checked=""/>
Update &quot;Crate Organization&quot; top-level section in generated crate docs</li>
<li><input disabled="" type="checkbox" checked=""/>
Update all module docs</li>
<li><input disabled="" type="checkbox" checked=""/>
Break up modules/files so that they're not 30k lines of code
<ul>
<li><input disabled="" type="checkbox" checked=""/>
models/types; each struct/enum should probably get its own file with pub-use</li>
<li><input disabled="" type="checkbox" checked=""/>
models/types::builders: now this needs to get split up</li>
<li><input disabled="" type="checkbox" checked=""/>
<code>client.rs</code></li>
</ul>
</li>
<li><input disabled="" type="checkbox" checked=""/>
Fix examples</li>
<li><input disabled="" type="checkbox" checked=""/>
Write changelog</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../rfcs/rfc0025_constraint_traits.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../rfcs/rfc0027_endpoints_20.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../rfcs/rfc0025_constraint_traits.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../rfcs/rfc0027_endpoints_20.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../static/mermaid.min.js"></script>
        <script src="../static/mermaid-init.js"></script>


    </div>
    </body>
</html>
